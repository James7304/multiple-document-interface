var T_ARR=[];function reposT_ARR(){if(T_ARR.length==0){console.error('ERROR :: reposT_ARR :: There are no tabs => no active tabs')}let activeTabId=getActiveTab().getAttribute('tab-id');let pos;let i=0;while(i<T_ARR.length){if(T_ARR[i].id==activeTabId){pos=i;i=T_ARR.length}i++}T_ARR.push(T_ARR[pos]);T_ARR[pos]=null;condenseT_ARR()}function condenseT_ARR(){let popBacks=0;for(var i=0;i<T_ARR.length;i++){if(T_ARR[i]==null){popBacks++;for(var j=i+1;j<T_ARR.length;j++){T_ARR[j-1]=T_ARR[j];T_ARR[j]='-'}}}for(var k=0;k<popBacks;k++){T_ARR.pop()}}var tabNo=1;function setNewTabID(a){a.setAttribute('tab-id',tabNo);tabNo++;return}function giveEventId(a){let id=Math.floor(Math.random()*1000000)+1000000;while(document.querySelector("[event-id='"+id+"']")){id=Math.floor(Math.random()*1000000)+1000000}a.setAttribute('event-id',id)}function getActiveTabId(){const active=document.querySelector("[data-type='tab-holder']").querySelector('.active');if(!active){return}return active.getAttribute('tab-id')}function getActiveTab(){return getTab(getActiveTabId())}function getActiveTabName(){return getTabName(getActiveTabId())}function getActiveTabSection(){return getTabSection(getActiveTabId())}function getActiveTabContent(){return getTabContent(getActiveTabId())}function getTab(a){return document.querySelector("[tab-id='"+a+"']")}function getTabName(a){const text=getTab(a).innerText;return text.substring(0,text.length-1)}function getTabSection(a){return document.querySelector("[content-id='"+a+"']")}function getTabContent(a){return document.querySelector("[content-id='"+a+"']").innerHTML}function changesToActiveTab(){getActiveTab().setAttribute('status','unsaved-changes')}function changesToTab(a){getTab(a).setAttribute('status','unsaved-changes')}function activeTabSaved(){getActiveTab().removeAttribute('status')}function tabSaved(a){getTab(a).removeAttribute('status')}function download(a,b,c){const blob=new Blob([c],{type:'txt'});if(window.navigator.msSaveOrOpenBlob){window.navigator.msSaveBlob(blob,a)}else{const elem=window.document.createElement('a');elem.href=window.URL.createObjectURL(blob);elem.download=a+"."+b;document.body.appendChild(elem);elem.click();document.body.removeChild(elem)}}function removeDlg(){document.querySelector('.modal-dlg').remove()}function createSaveValidationDialog(){return new Promise((resolve)=>{const modal=document.createElement('div');modal.classList.add('modal-dlg');const dlg=document.createElement('div');dlg.classList.add('dlg');const title=document.createElement('div');title.classList.add('dlg-header');title.innerText=appInfo.dialogTitle;const main=document.createElement('div');main.classList.add('dlg-main');main.innerHTML="<h1>Do you want to save the changes you made?</h1><p>Your changes will be lost if you don't save them.</p>";const buttons=document.createElement('div');buttons.classList.add('dlg-buttons');const cancelBtn=document.createElement('button');cancelBtn.innerText="Cancel";cancelBtn.onclick=()=>{removeDlg()};const dontBtn=document.createElement('button');dontBtn.innerText="Don't Save";dontBtn.onclick=()=>{removeDlg();resolve("Don't Save")};const saveBtn=document.createElement('button');saveBtn.innerText="Save";saveBtn.onclick=()=>{removeDlg();resolve("Save")};buttons.appendChild(cancelBtn);buttons.appendChild(dontBtn);buttons.appendChild(saveBtn);dlg.appendChild(title);dlg.appendChild(main);dlg.appendChild(buttons);modal.appendChild(dlg);document.body.appendChild(modal)})}function createSavingDialog(docCollection=appInfo.defaultDocumentCollection,tabid=getActiveTabId()){return new Promise((resolve)=>{const modal=document.createElement('div');modal.classList.add('modal-dlg');const dlg=document.createElement('div');dlg.classList.add('dlg');const title=document.createElement('div');title.classList.add('dlg-header');title.innerText=appInfo.dialogTitle;const main=document.createElement('div');main.classList.add('dlg-main');main.innerHTML="<h1>Where do you want to save your file to?</h1>";const saves=document.createElement('div');saves.classList.add('saves');main.appendChild(saves);const device=document.createElement('div');device.classList.add('save-btn');device.innerHTML="<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512' height='45'><path d='M528 0h-480C21.5 0 0 21.5 0 48v320C0 394.5 21.5 416 48 416h192L224 464H152C138.8 464 128 474.8 128 488S138.8 512 152 512h272c13.25 0 24-10.75 24-24s-10.75-24-24-24H352L336 416h192c26.5 0 48-21.5 48-48v-320C576 21.5 554.5 0 528 0zM512 288H64V64h448V288z'/></svg><br>Device";device.onclick=()=>{download(getTabName(tabid),appInfo.defaultFileType,docCollection());removeDlg();resolve('Saved')};saves.appendChild(device);const buttons=document.createElement('div');buttons.classList.add('dlg-buttons');const cancelBtn=document.createElement('button');cancelBtn.innerText="Cancel";cancelBtn.onclick=()=>{removeDlg()};buttons.appendChild(cancelBtn);dlg.appendChild(title);dlg.appendChild(main);dlg.appendChild(buttons);modal.appendChild(dlg);document.body.appendChild(modal)})}function giveTabEvents(a,b){$(a).on('activate',function(){const activeTab=getActiveTab();if(activeTab!=null){$(activeTab).trigger('deactivate')}this.classList.add('active');document.querySelector("[content-id='"+this.getAttribute('tab-id')+"']").style.display="block";reposT_ARR()});$(a).on('deactivate',function(){this.classList.remove('active');document.querySelector("[content-id='"+this.getAttribute('tab-id')+"']").style.display="none"});$(a).on('click',function(){if(this.querySelector('div').matches(':hover')){$(a).trigger('close')}else{$(a).trigger('activate')}});$(a).on('close',function(){function closeThis(){if(a.classList.contains('active')){T_ARR.pop();if(T_ARR.length>=1){$("[tab-id='"+T_ARR[T_ARR.length-1].id+"']").trigger('activate')}}document.querySelector("[content-id='"+a.getAttribute('tab-id')+"']").remove();a.remove();condenseT_ARR()}if(a.getAttribute('status')=='unsaved-changes'){createSaveValidationDialog().then((promise)=>{if(promise=="Save"){createSavingDialog(b,a.getAttribute('tab-id')).then((promise)=>{if(promise=="Saved"){closeThis()}})}else if(promise=="Don't Save"){closeThis()}})}else{closeThis()}})}function createTab(a){const defaultArgs={activate:true,content:appInfo.defaultTabContent,name:'untitled_doc',docCollection:appInfo.defaultDocumentCollection,saved:true};a=Object.assign({},defaultArgs,a);const tab=document.createElement('li');setNewTabID(tab);tab.innerHTML=a.name+'<div>✕</div>';document.querySelector("[data-type='tab-holder']").appendChild(tab);const tabContent=document.createElement('div');tabContent.classList.add('tab-section');tabContent.setAttribute('content-id',tab.getAttribute('tab-id'));if(a.content){a.content instanceof Element||a.content instanceof HTMLDocument?tabContent.appendChild(a.content):tabContent.innerHTML=a.content}document.querySelector("[data-type='tab-content']").appendChild(tabContent);T_ARR.push({id:tab.getAttribute('tab-id'),stateIndex:0,states:[$(tabContent).clone(true,true)]});giveTabEvents(tab,a.docCollection);if(a.activate){$(tab).trigger('activate')}if(!a.saved){changesToActiveTab()}return tab.getAttribute('tab-id')}function constructInitialTabs(){let tabs=document.querySelector("[data-type='tab-holder']").querySelectorAll('li');let tabContent=document.querySelector("[data-type='tab-content']").querySelectorAll('.tab-section');if(tabs.length>tabContent.length){for(var i=0;i<tabs.length-tabContent.length;i++){const new_content=document.createElement('div');new_content.classList.add('tab-section');document.querySelector("[data-type='tab-content']").appendChild(new_content)}console.warn('WARNING :: TABS-UNDO-REDO :: There are not the same number of tabs and tab contents :: There are more tabs')}else if(tabs.length<tabContent.length){for(var i=0;i<tabContent.length-tabs.length;i++){const new_tab=document.createElement('li');new_tab.innerText="untitled_doc";document.querySelector("[data-type='tab-holder']").appendChild(new_tab)}console.warn('WARNING :: TABS-UNDO-REDO :: There are not the same number of tabs and tab contents :: There are more tab contents')}tabs=document.querySelector("[data-type='tab-holder']").querySelectorAll('li');tabContent=document.querySelector("[data-type='tab-content']").querySelectorAll('.tab-section');let foundActive=false;for(var i=0;i<tabs.length;i++){setNewTabID(tabs[i]);const close_button=document.createElement('div');close_button.innerText='✕';tabs[i].appendChild(close_button);tabContent[i].setAttribute('content-id',tabs[i].getAttribute('tab-id'));tabContent[i].style.display="none";T_ARR.push({id:tabs[i].getAttribute('tab-id'),stateIndex:0,states:[$(tabContent[i]).clone(true,true)]});giveTabEvents(tabs[i]);if(tabs[i].classList.contains('active')){if(!foundActive){$(tabs[i]).trigger('activate');foundActive=true}else{tabs[i].classList.remove('active')}}}if(tabs.length>0&&!foundActive){$(tabs[0]).trigger('activate')}}function doneAction(a){for(var i=T_ARR[T_ARR.length-1].states.length-1;i>T_ARR[T_ARR.length-1].stateIndex;i--){T_ARR[T_ARR.length-1].states.pop()}T_ARR[T_ARR.length-1].states.push($(getActiveTabSection()).clone(true,true));T_ARR[T_ARR.length-1].stateIndex=T_ARR[T_ARR.length-1].states.length-1;if(unsavedChanges){changesToActiveTab()}}function undo_action(){if(T_ARR[T_ARR.length-1].stateIndex>0){T_ARR[T_ARR.length-1].stateIndex--;getActiveTabSection().innerHTML=T_ARR[T_ARR.length-1].states[T_ARR[T_ARR.length-1].stateIndex][0].innerHTML}}function redo_action(){if(T_ARR[T_ARR.length-1].stateIndex<T_ARR[T_ARR.length-1].states.length-1){T_ARR[T_ARR.length-1].stateIndex++;getActiveTabSection().innerHTML=T_ARR[T_ARR.length-1].states[T_ARR[T_ARR.length-1].stateIndex][0].innerHTML}}function giveEvent(a,b,c){let end=false;let parent=a;while(!end){parent=parent.parentElement;if(parent.classList.contains('tab-section')){end=true}else if(parent.tagName=='BODY'){return console.error("ERROR :: giveEvent :: Element given is not a child of a tab")}}if(a.getAttribute('event-id')==null){giveEventId(a)}$(parent).on(b,"[event-id='"+a.getAttribute('event-id')+"']",c)}function giveShortcuts(a){const defaultArgs={undo:[{ctrl:true,shft:false,key:'z'}],redo:[{ctrl:true,shft:true,key:'z'},{ctrl:true,shft:false,key:'y'}],closeTab:[{ctrl:true,shft:false,key:'q'}],newTab:[{ctrl:true,shft:false,key:'b'}],save:[{ctrl:true,shft:false,key:'s'}],};a=Object.assign({},defaultArgs,a);document.addEventListener('keydown',(event)=>{for(var i=0;i<a.undo.length;i++){if(event.ctrlKey==a.undo[i].ctrl&&event.shiftKey==a.undo[i].shft&&event.key.toLowerCase()==a.undo[i].key){event.preventDefault();undo_action();return}}for(var i=0;i<a.redo.length;i++){if(event.ctrlKey==a.redo[i].ctrl&&event.shiftKey==a.redo[i].shft&&event.key.toLowerCase()==a.redo[i].key){event.preventDefault();redo_action();return}}for(var i=0;i<a.closeTab.length;i++){if(event.ctrlKey==a.closeTab[i].ctrl&&event.shiftKey==a.closeTab[i].shft&&event.key.toLowerCase()==a.closeTab[i].key){event.preventDefault();$(getActiveTab()).trigger('close');return}}for(var i=0;i<a.newTab.length;i++){if(event.ctrlKey==a.newTab[i].ctrl&&event.shiftKey==a.newTab[i].shft&&event.key.toLowerCase()==a.newTab[i].key){event.preventDefault();createTab({saved:false});return}}for(var i=0;i<a.save.length;i++){if(event.ctrlKey==a.save[i].ctrl&&event.shiftKey==a.save[i].shft&&event.key.toLowerCase()==a.save[i].key){event.preventDefault();createSavingDialog(appInfo.defaultDocumentCollection);return}}})}let appInfo={dialogTitle:'Click to continue',defaultTabContent:"",defaultDocumentCollection:()=>{return getActiveTabSection().innerHTML},defaultFileType:"html"};function giveAppInfo(a){appInfo=Object.assign({},appInfo,a)}constructInitialTabs();